<!DOCTYPE html>
<html lang="en">
{% extends 'layout.html'%}
{% load widget_tweaks %}
{% block content %}
<head>
    <title>Map</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
</head>

<body style="margin-top: 62px">

    <div class="form-row" style="background-color: aliceblue; padding: 5px;">
        <div class="col-md-6 input-group mr-2">
            <div class="input-group-prepend">
                <div class="input-group-text" style="width:80px">Search</div>
            </div>
            {% render_field form.search_string class="form-control" %}
        </div>

        <div class="form-check form-check-inline">
            {% render_field form.show_bookmarked_venues class="form-check-input" %}
            <!--<input class="form-check-input" type="checkbox" id="inlineCheckbox1" value="option1">-->
            <label class="form-check-label">Bookmarked venues</label>
        </div>
        <div class="form-check form-check-inline">
            {% render_field form.show_bookmarked_events class="form-check-input" %}
            <!--<input class="form-check-input" type="checkbox" id="inlineCheckbox2" value="option2">-->
            <label class="form-check-label" for="inlineCheckbox2">Bookmarked events</label>
        </div>
    </div>

    <div id="mapid" style="background: beige; height: 500px;"></div>
    <script type="text/javascript">
        const mapboxAccessToken = 'pk.eyJ1IjoibHZzeiIsImEiOiJjam9qOXIzdTYwMnFpM2t2d2MyaHJxcXJsIn0.EBOtf2ATioNXLSCXj2DxGQ'
        // VUB
        var start = L.latLng(50.8227, 4.3950);
        // Grand Place
        var dest = L.latLng(50.84656, 4.3526);

        // create the map
        var mymap = L.map('mapid').setView(dest,5);
        var marker = L.marker(start);

        function userLocation(e) {
            start = e.latlng;
            mymap.setView(start,15);
            //marker.setLatLng(e.latlng).addTo(mymap);
            control.setWaypoints([start, dest]);
        }

        mymap.on('locationfound', userLocation).setView(start,15).locate();

        // create tile layer for mymap
        L.tileLayer(`https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=${mapboxAccessToken}`, {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 19,
            id: 'mapbox.streets',
        }).addTo(mymap);

        // routing plugin
        function createButton(label, container) {
            var btn = L.DomUtil.create('button', 'a', container);
            btn.setAttribute('type', 'button');
            btn.innerHTML = label;
            return btn;
        }

        var control = L.Routing.control({
            // waypoints: [ start, dest ],
            router: L.Routing.mapbox(mapboxAccessToken, { profile: 'mapbox/walking' })
            //router: new L.Routing.osrmv1({serviceUrl: '//router.project-osrm.org/viaroute', profile: 'foot'})
        }).addTo(mymap);

        mymap.on('click', function(e) {
            console.log("hello");
            var container = L.DomUtil.create('div'),
                // startBtn = createButton('Start from this location', container),
                destBtn = createButton('Go to this location', container);

            L.popup()
                .setContent(container)
                .setLatLng(e.latlng)
                .openOn(mymap);

            L.DomEvent.on(destBtn, 'click', function() {
                control.spliceWaypoints(
                    control.getWaypoints().length - 1, 1, e.latlng);
                mymap.closePopup();
            });
        });
    </script>

</body>
{% endblock %}

